<?xml version="1.0" encoding="UTF-8"?>
<!--设置log4j2的自身log级别为warn -->
<configuration status="warn">
    <properties>
        <!-- 全局参数 -->
        <Property name="pattern">[%d{MM:dd:HH:mm:ss:SSS}] %p [%t] [%traceId] [%X{userId}] [%X{time}] @@%c{1}@@ | %m%n</Property>
        <Property name="log_path">log</Property>
    </properties>
    <Appenders>
        <console name="Console" target="SYSTEM_OUT">
            <PatternLayout>
                <Pattern>%highlight{[%d{MM:dd:HH:mm:ss:SSS]} %p [%t] [%traceId] [%X{userId}] [%X{time}] @@%c{1}@@ | %m%n}{FATAL=Bright Red, ERROR=Bright
                    Red, WARN=Red, INFO=Bright Cyan, DEBUG=Bright White, TRACE=Bright Blue}
                </Pattern>
            </PatternLayout>
        </console>

        <RollingFile name="RollingFileAll" fileName="${log_path}/all.log" filePattern="${log_path}/all-%d{yyyy-MM-dd}-%i.log">
            <PatternLayout>
                <Pattern>${pattern}</Pattern>
            </PatternLayout>
            <Policies>
                <!-- 归档每天的文件 -->
                <TimeBasedTriggeringPolicy interval="1" modulate="true" />
                <!-- 限制单个文件大小 -->
                <SizeBasedTriggeringPolicy size="1000 MB"/>
            </Policies>
            <!-- 限制每天文件个数 -->
            <DefaultRolloverStrategy max="5">
                <Delete basePath="${log_path}/" maxDepth="2">
                    <IfFileName glob="*.log" />
                    <IfLastModified age="1d" />
                </Delete>
                <Delete basePath="${log_path}/access_log/" maxDepth="2">
                    <IfFileName glob="*.log" />
                    <IfLastModified age="1d" />
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>
    </Appenders>

    <Loggers>
        <!-- 使用异步日志，需要依赖于Disruptor -->
        <asyncRoot level="info" includeLocation="true">
            <Appender-ref ref="Console"/>
            <Appender-ref ref="RollingFileAll"/>
        </asyncRoot>
    </Loggers>

</configuration>